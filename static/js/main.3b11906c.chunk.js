(this.webpackJsonpexcel2pic=this.webpackJsonpexcel2pic||[]).push([[0],{32:function(e,t){},40:function(e,t,a){},48:function(e,t,a){},54:function(e,t){},55:function(e,t){},96:function(e,t,a){"use strict";a.r(t);var n=a(5),i=a(0),c=a.n(i),s=a(11),l=a.n(s),o=(a(48),a(19)),r=a(20),d=a(22),h=a(21),g=a(30),u=a.n(g),v=a(101),p=a(102),j=a(104),m=a(103),b=(a(56),a(23)),x=a.n(b),f=(a(40),{}),O=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).initStage=function(){var e=n.props,t=e.canvasWidth,a=e.canvasHeight,i=new x.a.Stage({x:0,y:0,container:"container",width:t,height:a});n.setState({stage:i})},n.updateBgImg=function(){var e=n.props,t=e.bgImg,a=e.canvasWidth,i=e.canvasHeight,c=n.state.stage,s=new x.a.Layer,l=new x.a.Image({x:0,y:0,image:t,width:a,height:i});s.add(l),s.batchDraw(),c.width(a),c.height(i),c.add(s)},n.state=f,n}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.initStage()}},{key:"componentWillUnmount",value:function(){}},{key:"componentDidUpdate",value:function(e){this.props.bgImg!==e.bgImg&&this.updateBgImg()}},{key:"render",value:function(){var e=this.props,t=e.canvasHeight,a=e.canvasWidth;return Object(n.jsx)("div",{className:"container",id:"container",style:{width:a,height:t}})}}]),a}(c.a.Component),y=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).initCanvas=function(){for(var e=document.getElementById("uploadBgBlock"),t=e.offsetWidth,a=e.offsetHeight,i=800,c=600,s=.1;t<i||a<c;)i/=s,c/=s,s+=.1;n.setState({canvasWidth:i,canvasHeight:c,lastUploadBgOfWidth:t,lastUploadBgOfHeight:a})},n.updateCanvas=function(){var e,t=n.state,a=t.lastUploadBgOfWidth,i=t.lastUploadBgOfHeight,c=t.canvasWidth,s=t.canvasHeight,l=document.getElementById("uploadBgBlock"),o=l.offsetWidth,r=l.offsetHeight;c*(e=o!==a?o/a:r!==i?r/i:o/a>r/i?o/a:r/i)>800||s*e>600?n.setState({canvasWidth:800,canvasHeight:600,lastUploadBgOfWidth:o,lastUploadBgOfHeight:r}):n.setState({canvasWidth:c*e,canvasHeight:s*e,lastUploadBgOfWidth:o,lastUploadBgOfHeight:r})},n.onImportExcel=function(e){for(var t=new FileReader,a=0;a<e.length;a++)t.name=e[a].name;t.onload=function(e){try{var t=[".xlsx",".xls"],a=e.target.name,i=a.substring(a.lastIndexOf("."));if(-1===t.indexOf(i))throw new Error("\u6a94\u6848\u985e\u578b\u932f\u8aa4\uff0c\u53ea\u53ef\u63a5\u53d7\uff1a"+t.toString()+"\u6a94\u6848\u540d\u7a31");var c=e.target.result,s=u.a.read(c,{type:"binary"}),l=[];for(var o in s.Sheets)s.Sheets.hasOwnProperty(o)&&(l=l.concat(u.a.utils.sheet_to_json(s.Sheets[o])));if(0===l.length)throw new Error("excel\u6c92\u6709\u4efb\u4f55\u8cc7\u6599");n.setState({excelHint:!1}),n.getExcelTitle(l)}catch(r){return void alert(r)}},t.readAsBinaryString(e[0])},n.getExcelTitle=function(e){var t=[];for(var a in e[0])t.push(a);console.log(t),n.setState({excelData:e,excelTitleData:t})},n.handleImageChange=function(e){var t=new FileReader,a=e.target.files[0];t.onloadend=function(){var e=new window.Image;e.onload=function(){n.setState({bgImgHint:!1,bgImg:e})},e.src=t.result},t.readAsDataURL(a)},n.changeRatio=function(){var e=document.getElementById("bgRatio").value;"small"===e?n.setState({ratio:2.2}):"middle"===e?n.setState({ratio:2}):"big"===e&&n.setState({ratio:1.8})},n.download=function(){var e=n.state.stage,t=document.createElement("a"),a=new MouseEvent("click");t.download="test.jpg",t.href=e.toDataURL(),t.dispatchEvent(a)},n.updatePreviewImg=function(){var e=n.state,t=e.bgImg,a=e.excelData;t||a?t?a||(alert("\u8acb\u4e0a\u50b3excel\u6a94\u6848"),n.setState({excelHint:!0})):(alert("\u8acb\u4e0a\u50b3\u80cc\u666f\u5716"),n.setState({bgImgHint:!0})):(alert("\u8acb\u4e0a\u50b3\u80cc\u666f\u5716&excel\u6a94\u6848"),n.setState({excelHint:!0,bgImgHint:!0}))},n.state={ratio:2,canvasWidth:800,canvasHeight:600,bgImg:null,excelData:null,excelTitleData:null,excelHint:!1,bgImgHint:!1,lastUploadBgOfWidth:1,lastUploadBgOfHeight:1},n}return Object(r.a)(a,[{key:"componentDidMount",value:function(){this.initCanvas(),window.addEventListener("resize",this.updateCanvas)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateCanvas)}},{key:"render",value:function(){var e=this.state,t=e.canvasWidth,a=e.canvasHeight,i=e.excelHint,c=e.bgImgHint,s=e.ratio,l=e.bgImg;return Object(n.jsxs)("div",{className:"App",children:[Object(n.jsx)("div",{className:"topBlock",children:Object(n.jsx)("div",{className:"topText",children:"excel2picture demo"})}),Object(n.jsx)("div",{className:"cotentBlock",children:Object(n.jsxs)("div",{className:"uploadBlock",children:[Object(n.jsxs)("div",{className:"uploadBgBlock",id:"uploadBgBlock",children:[Object(n.jsxs)("div",{style:{width:"80%",marginTop:"20px",fontFamily:"sans-serif"},children:[Object(n.jsxs)(v.a,{defaultActiveKey:"0",children:[Object(n.jsxs)(p.a,{children:[Object(n.jsx)(v.a.Toggle,{as:p.a.Header,style:{fontWeight:"bold",color:"#0066CC"},eventKey:"0",children:"step 1 : \u9078\u64c7\u9810\u89bd\u5716\u7247\u5927\u5c0f"}),Object(n.jsx)(v.a.Collapse,{eventKey:"0",children:Object(n.jsx)(p.a.Body,{children:Object(n.jsxs)("select",{id:"bgRatio",onChange:this.changeRatio,defaultValue:"middle",children:["\u3000        ",Object(n.jsx)("option",{value:"small",children:"small"}),"\u3000        ",Object(n.jsx)("option",{value:"middle",children:"middle"}),Object(n.jsx)("option",{value:"big",children:"big"})]})})})]}),Object(n.jsxs)(p.a,{children:[Object(n.jsx)(v.a.Toggle,{as:p.a.Header,style:{fontWeight:"bold",color:i?"red":"#0066CC"},eventKey:"1",children:"step 2 : \u4e0a\u50b3excel\u6a94\u6848"}),Object(n.jsx)(v.a.Collapse,{eventKey:"1",children:Object(n.jsx)(p.a.Body,{children:Object(n.jsx)(m.a,{accept:".xlsx, .xls",onChange:this.onImportExcel,children:Object(n.jsx)("button",{className:"btn btn-primary",children:"\u4e0a\u50b3excel\u8cc7\u6599"})})})})]}),Object(n.jsxs)(p.a,{children:[Object(n.jsx)(v.a.Toggle,{as:p.a.Header,style:{fontWeight:"bold",color:c?"red":"#0066CC"},eventKey:"2",children:"step 3 : \u4e0a\u50b3\u80cc\u666f\u5716\u7247"}),Object(n.jsx)(v.a.Collapse,{eventKey:"2",children:Object(n.jsx)(p.a.Body,{children:Object(n.jsxs)("label",{className:"btn btn-primary",style:{marginBottom:"0"},children:["\u4e0a\u50b3\u80cc\u666f\u5716\u7247",Object(n.jsx)("input",{type:"file",style:{display:"none"},onChange:this.handleImageChange,accept:"image/*"})]})})})]})]}),Object(n.jsx)(j.a,{variant:"info",style:{width:"100%",marginTop:"10px"},onClick:this.updatePreviewImg,children:"\u7522\u751f\u9810\u89bd\u7d50\u679c"})," "]}),Object(n.jsx)(O,{canvasWidth:t/s,canvasHeight:a/s,bgImg:l})]}),Object(n.jsx)("div",{className:"generateImageBlock",children:"\u8acb\u5148\u9078\u64c7\u8cc7\u6599\u53ca\u5716\u7247\uff0c\u4e26\u9810\u89bd\u7d50\u679c"})]})})]})}}]),a}(c.a.Component);l.a.render(Object(n.jsx)(y,{}),document.getElementById("root"))}},[[96,1,2]]]);
//# sourceMappingURL=main.3b11906c.chunk.js.map